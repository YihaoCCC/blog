---
title: "ğŸ“§ Spring-boot-mail å‘é€é‚®ä»¶"
date: 2023-07-12 21:38:11
updated: 
tags: [Spring, Java]
categories: åç«¯
keywords:
description:
top_img: https://images.unsplash.com/photo-1688934150111-ab9a5d327087?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2064&q=80
comments:
cover: https://images.unsplash.com/photo-1688934150111-ab9a5d327087?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2064&q=80
toc:
toc_number:
toc_style_simple:
copyright: false
copyright_author:
copyright_author_href: false
copyright_url:
copyright_info:
mathjax:
katex:
aplayer:
highlight_shrink:
aside:

---
## spring-boot-mail å‘é€é‚®ä»¶

IDE: Intellij Idea 2020.1 X64

JDK: 1.8.0_271

### 1.é…ç½®æ–‡ä»¶ application.yml:

```yaml
spring:
  mail:
    host: smtp.qq.com
    username: 1491269442@qq.com
    password: ebfoakapdkupjdcc
    properties.mail.smtp.auth: true
    properties.mail.smtp.starttls.enable: true
```

ç”±äºæ­¤å¤„ä½¿ç”¨çš„é‚®ç®±å¼•æ“æ˜¯QQ,æ­¤å¤„çš„é‚®ç®±passwordéœ€è¦ä½¿ç”¨QQé‚®ç®±ç”Ÿæˆçš„æˆæƒç ï¼Œæ­¤å¤„å°†æˆæƒç åšå¯†ç ä½¿ç”¨ã€‚

#### QQé‚®ç®±è®¾ç½®å¦‚ä¸‹ï¼š

![image-20210612225426374](C:\Users\LENOVO\AppData\Roaming\Typora\typora-user-images\image-20210612225426374.png)

QQé‚®ç®±æˆæƒç ï¼š

[QQé‚®ç®±æˆæƒç ]: https://service.mail.qq.com/cgi-bin/help?subtype=1&&no=1001256&&id=28

### 2.pom.xmlä¾èµ–å¼•å…¥ï¼š

```yaml
 <dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-mail</artifactId>
 </dependency>

```

### 3.é‚®ä»¶å‘é€æœåŠ¡ï¼š

```java
package tcu.example.springbootemail.srervice;

public interface EmailService {

    void sendSimpleMail();

    void sendHtmlMail();

    void sendAttachmentsMail();

    void sendInlineMail();

    void sendTemplateMail();
}
```

### 4.é‚®ä»¶å‘é€æœåŠ¡å®ç°ï¼š

```java
package tcu.example.springbootemail.srervice.Impl;


import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.core.io.FileSystemResource;
import org.springframework.mail.SimpleMailMessage;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.stereotype.Service;
import org.thymeleaf.TemplateEngine;
import org.thymeleaf.context.Context;
import tcu.example.springbootemail.srervice.EmailService;

import javax.mail.internet.MimeMessage;
import java.io.File;
import java.util.HashMap;
import java.util.Map;
import java.util.Properties;

@Slf4j
@Service
public class EmailServiceImpl implements EmailService {

    @Autowired
    private JavaMailSender mailSender;

    @Autowired
    private TemplateEngine templateEngine;

    @Value("${spring.mail.username}")
    private String Sender; //è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°

    @Override
    public void sendSimpleMail() {

        SimpleMailMessage message = new SimpleMailMessage();
        message.setFrom(Sender);
        message.setTo(Sender); //è‡ªå·±ç»™è‡ªå·±å‘é€é‚®ä»¶
        message.setSubject("ä¸»é¢˜ï¼šç®€å•é‚®ä»¶");
        message.setText("æµ‹è¯•é‚®ä»¶å†…å®¹");
        mailSender.send(message);
    }

    @Override
    public void sendHtmlMail() {
        MimeMessage message = null;
        try {
            message = mailSender.createMimeMessage();
            MimeMessageHelper helper = new MimeMessageHelper(message, true);
            helper.setFrom(Sender);
            helper.setTo(Sender);
            helper.setSubject("æ ‡é¢˜ï¼šå‘é€Htmlå†…å®¹");

            StringBuffer sb = new StringBuffer();
            sb.append("<h1>å¤§æ ‡é¢˜-h1</h1>")
                    .append("<p style='color:#F00'>çº¢è‰²å­—</p>")
                    .append("<p style='text-align:right'>å³å¯¹é½</p>");
            helper.setText(sb.toString(), true);
        } catch (Exception e) {
            e.printStackTrace();
        }
        mailSender.send(message);
    }

    @Override
    //æœ‰é™„ä»¶çš„é‚®ä»¶
    public void sendAttachmentsMail() {
        MimeMessage message = null;
        try {
            message = mailSender.createMimeMessage();
            MimeMessageHelper helper = new MimeMessageHelper(message, true);
            helper.setFrom(Sender);
            helper.setTo(Sender);
            helper.setSubject("ä¸»é¢˜ï¼šå¸¦é™„ä»¶çš„é‚®ä»¶");
            helper.setText("å¸¦é™„ä»¶çš„é‚®ä»¶å†…å®¹");
            //æ³¨æ„é¡¹ç›®è·¯å¾„é—®é¢˜ï¼Œè‡ªåŠ¨è¡¥ç”¨é¡¹ç›®è·¯å¾„
            FileSystemResource file = new FileSystemResource(new File("D:/Temp/picture.jpg"));
            //åŠ å…¥é‚®ä»¶
            helper.addAttachment("å›¾ç‰‡.jpg", file);
        } catch (Exception e){
            e.printStackTrace();
        }
        mailSender.send(message);
    }

    @Override
    //å¸¦é™æ€èµ„æºçš„é‚®ä»¶
    public void sendInlineMail() {
        MimeMessage message = null;
        try {
            message = mailSender.createMimeMessage();
            MimeMessageHelper helper = new MimeMessageHelper(message, true);
            helper.setFrom(Sender);
            helper.setTo(Sender);
            helper.setSubject("ä¸»é¢˜ï¼šå¸¦é™æ€èµ„æºçš„é‚®ä»¶");
            //ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šå‘é€çš„æ˜¯HTMLæ ¼å¼,åŒæ—¶cid:æ˜¯å›ºå®šçš„å†™æ³•
            helper.setText("<html><body>å¸¦é™æ€èµ„æºçš„é‚®ä»¶å†…å®¹ å›¾ç‰‡:<img src='cid:picture' /></body></html>", true);

            FileSystemResource file = new FileSystemResource(new File("D:/Temp/picture.jpg"));
            helper.addInline("picture",file);
        } catch (Exception e){
            e.printStackTrace();
        }
        mailSender.send(message);
    }

    @Override
    //æ‰¹é‡é‚®ä»¶
    public void sendTemplateMail() {

        String[] filePath = new String[]{"D:\\Temp\\picture.jpg", "D:\\Temp\\picture1.jpg"};
        Map<String, Object> valueMap = new HashMap<>();
        valueMap.put("to", new String[]{Sender, "1531788169@qq.com", "2818980498@qq.com"});
        valueMap.put("title", "æµ‹è¯•Thymeleafæ¨¡æ¿æ‰¹é‡å‘é€é‚®ä»¶");
        valueMap.put("content", "é‚®ä»¶å†…å®¹");
        valueMap.put("filePathList", filePath);

        MimeMessage mimeMessage = null;
        try {
            mimeMessage = mailSender.createMimeMessage();
            MimeMessageHelper helper = new MimeMessageHelper(mimeMessage, true);
            // è®¾ç½®å‘ä»¶äººé‚®ç®±
            helper.setFrom(Sender);
            // è®¾ç½®æ”¶ä»¶äººé‚®ç®±
            helper.setTo(Sender);
            // è®¾ç½®é‚®ä»¶æ ‡é¢˜
            helper.setSubject(valueMap.get("title").toString());

            // æ·»åŠ æ­£æ–‡ï¼ˆä½¿ç”¨thymeleafæ¨¡æ¿ï¼‰
            Context context = new Context();
            context.setVariables(valueMap);
            String content = this.templateEngine.process("mail", context);
            helper.setText(content, true);

            // æ·»åŠ é™„ä»¶
            if (valueMap.get("filePathList") != null) {
                String[] filePathList = (String[]) valueMap.get("filePathList");
                for(String path: filePathList) {
                    FileSystemResource file = new FileSystemResource(new File(path));
                    // æ–‡ä»¶è·¯å¾„åç§°Windowså†™\\ï¼ŒLinuxå†™/ï¼Œå¦åˆ™æŠ¥é”™java.lang.StringIndexOutOfBoundsException: String index out of range: -1
                    String fileName = path.substring(path.lastIndexOf(File.separator));
                    helper.addAttachment(fileName, file);
                }
            }
            mailSender.send(mimeMessage);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

```

### 5.æ§åˆ¶ç±» EmailController:

```java
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import tcu.example.springbootemail.srervice.EmailService;

@Controller
public class EmailController {

    @Autowired
    private EmailService emailService;

    @GetMapping(value = {"", "/", "/index"})
    public String index() {
        return "index";
    }

    // å‘é€ç®€å•é‚®ä»¶
    @GetMapping("sendSimpleMail")
    public String sendSimpleMail() {
        emailService.sendSimpleMail();
        return "index";
    }

    // å‘é€Htmlé‚®ä»¶
    @GetMapping("sendHtmlMail")
    public String sendHtmlMail() {
        emailService.sendHtmlMail();
        return "index";
    }

    // å‘é€å¸¦é™„ä»¶çš„é‚®ä»¶
    @GetMapping("sendAttachmentsMail")
    public String sendAttachmentsMail() {
        emailService.sendAttachmentsMail();
        return "index";
    }

    // å‘é€å¸¦é™æ€èµ„æºçš„é‚®ä»¶
    @GetMapping("sendInlineMail")
    public String sendInlineMail() {
        emailService.sendInlineMail();
        return "index";
    }

    // å‘é€æ¨¡æ¿é‚®ä»¶
    @GetMapping("sendTemplateMail")
    public String sendTemplateMail() {
        emailService.sendTemplateMail();
        return "index";
    }

}
```

